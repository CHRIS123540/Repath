# Hopa Reapth Control Plane Code

## 探测方案

#### 采用随路与全路径结合的方式进行路径探测

### 1  **周期性全路径探测**
   - 每隔 `x` ms 向四路发送 `perbe` 探测包，统计每条路的单向时延（此处使用时间差代替，避免时钟同步问题），计算当前最优的repath路径

> **!** 探测报文方向 : cq ------> yy

### 2  **随路检测探测**
   - 数据路径发送的数据包中填充ts时间戳，收端DP模块向CP模块递交ts用于随路检测

### 3  **随路信息提供换路信号**
   - 统计单向时延
   - 检测软切和硬切条件
   - CP模块提交repath信号（最优路径使用全路径探测结果）

### 4  **信令定义**
   - `repath` : 换路信号
   - `repath_ack` : 确认信号

### 5  **`repath`丢失恢复**
   - 通过 `ACK` 实现丢失恢复机制